services:
  nazr:
    # Lightweight build WITHOUT facial recognition
    # This reduces binary size by ~200MB and memory usage by ~200-300MB
    image: markraidc/nazr-backend-sqlite:latest-no-face-arm64
    platform: linux/arm64
    container_name: nazr
    environment:
      - FLASH_ROOT=/photos
      - FLASH_ROOT_HOST=/volume1/photos
      - FLASH_DATA=/flash-data
      - FLASH_PORT=9161
      - GPU_ACCEL=qsv   # Targeted for DS220+ (Intel J4025 supports QSV)
    volumes:
      - /volume1/photos:/photos:rw
      - /volume1/nazr:/flash-data:rw
      # Mount specific directories for browsing (more secure than mounting entire root)
      # Add or remove directories as needed for your use case
      - /volume1:/host/volume1:ro  # Read-only access to volume1
      - /home:/host/home:ro  # Read-only access to home directories
      - /mnt:/host/mnt:ro  # Read-only access to mounted drives
      # Uncomment if you need write access to specific locations:
      # - /volume1:/host/volume1:rw
    ports:
      - "9161:9161"
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    deploy:
      resources:
        limits:
          # Use all available CPUs (remove or set to higher value to use more cores)
          # cpus: "2.0"  # Commented out to allow using all available cores
          # DS220+ has 2GB RAM. Without facial recognition, 512MB-768MB is sufficient.
          memory: 768M
        # GPU acceleration (uncomment and configure as needed):
        # For NVIDIA CUDA:
        #   reservations:
        #     devices:
        #       - driver: nvidia
        #         count: all
        #         capabilities: [gpu]
    # Intel QSV Configuration for DS220+ (J4025):
    devices:
      - /dev/dri:/dev/dri:ro

