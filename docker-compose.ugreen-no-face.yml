services:
  nazr:
    # Lightweight build WITHOUT facial recognition
    # This reduces binary size by ~200MB and memory usage by ~200-300MB
    image: markraidc/nazr-backend-sqlite:latest-no-face-arm64
    platform: linux/arm64
    container_name: nazr
    environment:
      - FLASH_ROOT=/photos
      - FLASH_ROOT_HOST=/mnt/ugreen/photos
      - FLASH_DATA=/flash-data
      - FLASH_PORT=9161
      - GPU_ACCEL=auto  # Auto-detect GPU acceleration (CUDA, QSV, etc.)
    volumes:
      # Update these paths to match your Ugreen NAS volume structure
      # Common Ugreen NAS paths: /mnt/ugreen, /volume1, or /mnt/ugreen-nas
      - /mnt/ugreen/photos:/photos:rw
      - /mnt/ugreen/nazr:/flash-data:rw
      # Mount specific directories for browsing (more secure than mounting entire root)
      # Add or remove directories as needed for your use case
      - /mnt:/host/mnt:ro  # Read-only access to mounted drives
      - /home:/host/home:ro  # Read-only access to home directories
      # Uncomment and adjust if your Ugreen NAS uses different paths:
      # - /volume1:/host/volume1:ro
      # - /mnt/ugreen:/host/ugreen:ro
    ports:
      - "9161:9161"
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    deploy:
      resources:
        limits:
          # Use all available CPUs (remove or set to higher value to use more cores)
          # cpus: "2.0"  # Commented out to allow using all available cores
          # Without facial recognition, 384MB-512MB is sufficient (adjust based on your NAS specs)
          memory: 384M
        # GPU acceleration (uncomment and configure as needed):
        # For NVIDIA CUDA:
        #   reservations:
        #     devices:
        #       - driver: nvidia
        #         count: all
        #         capabilities: [gpu]
    # For Intel QSV (common on Ugreen NAS with Intel CPUs):
    #   Uncomment the devices section below and change GPU_ACCEL to 'qsv' in environment above
    #   devices:
    #     - /dev/dri:/dev/dri:ro

